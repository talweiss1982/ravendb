<div data-bind="if: databases().sortedDatabases().length === 0">
    <div class="row">
        <div class="col-sm-8 col-sm-offset-2 col-lg-6 col-lg-offset-3">
            <i class="icon-xl icon-empty-set text-muted"></i>
            <h2 class="text-center">No databases have been created</h2>
            <p class="lead text-center text-muted">Go ahead and<a href="#" data-bind="click: createNewDatabase">&nbsp;create one now</a></p>
        </div>
    </div>
</div>
<div class="resources" data-bind="if: databases().sortedDatabases().length, css: { 'resources_compact': compactView() }">
    <div class="resourcesToolbar toolbar clearfix">
        <div class="form-inline">
            <div class="checkbox checkbox-primary checkbox-inline align-checkboxes">
                <input type="checkbox" class="styled" data-bind="checkboxTriple: selectionState, event: { change: toggleSelectAll }">
                <label></label>
            </div>
            <div class="input-group">
                <input type="text" class="form-control" placeholder="Filter" accesskey="/" title="Filter databases (Alt+/)" data-bind="textInput: filters.searchText">    
            </div>
            <div class="resourcesToolbar-actions">
                <button class="btn btn-primary" data-bind="click: newDatabase">
                    <i class="icon-plus"></i>
                    <span>New database</span>
                </button>
                
                <div class="btn-group-label" data-label="Selection" role="group">
                    <button class="btn btn-danger" data-bind="visible: isGlobalAdmin(), enable: selectedDatabases().length, click: deleteSelectedDatabases">
                        <i class="icon-trash"></i>
                        <span>Delete</span>
                    </button>
                    
                    <div class="btn-group">
                        <button type="button" class="btn btn-default dropdown-toggle" title="Change the options of selected databases"
                                data-bind="enable: selectedDatabases().length && !spinners.globalToggleDisable(), css: { 'btn-spinner': spinners.globalToggleDisable() }" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="icon-play"></i><span>Set state...</span>
                            <span class="caret"></span>
                            <span class="sr-only">Toggle Dropdown</span>
                        </button>
                        <ul class="dropdown-menu">
                            <li data-bind="click: enableSelectedDatabases">
                                <a href="#" title="Enable">
                                    <i class="icon-unlock"></i>
                                    <span>Enable</span>
                                </a>
                            </li>
                            <li data-bind="click: disableSelectedDatabases">
                                <a href="#" title="Disable">
                                    <i class="icon-lock"></i>
                                    <span>Disable</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="toggle toggle-primary resourcesToolbar-toggleCompactView pull-right">
                <input id="compactViewInput" name="compactView" class="styled" type="checkbox" data-bind="checked: $root.compactView" />
                <label for="compactViewInput">
                    Compact View
                </label>
            </div>
        </div>
    </div> 
    
    <div data-bind="foreach: databases().sortedDatabases">
        <div class="panel resource" data-bind="scrollTo: isCurrentlyActiveDatabase(), visible: !filteredOut(), attr: { class: 'panel resource ' + badgeClass() + ' ' + (isCurrentlyActiveDatabase() ? 'active' : '') }">
            <div class="padding padding-sm">
                <div data-bind="click: $root.activateDatabase, attr: { 'data-state-text': badgeText, class: 'state ' + badgeClass() }"></div>
                <div class="row">
                    <div class="col-xs-12 col-sm-6 col-xl-4 info-container">
                        <div class="checkbox">
                            <input type="checkbox" class="styled" data-bind="checked: $root.selectedDatabases, checkedValue: qualifiedName">
                            <label></label>
                        </div>
                        <h3 class="resource-name">
                            <i class="icon-database"></i>
                            <span title="Database is disabled" data-bind="visible: !canNavigateToDatabase(), text: name"></span>
                            <a data-bind="attr: { title: name, href: $root.databaseUrl($data) }, text: name, visible: canNavigateToDatabase()" href="#"></a>
                        </h3>
                    </div>

                    <div class="col-xs-12 col-sm-12 col-xl-5 vertical-divider properties-container" 
                         data-bind="template: { name: hasLoadError() ? 'invalid-database-properties-template': 'valid-database-properties-template' }">
                    </div>
                    <div class="col-xs-12 col-sm-6 col-xl-3 actions-container">
                        <span data-bind="visible: isLoading">
                            <span class="global-spinner"></span>&nbsp;&nbsp;&nbsp;&nbsp;
                        </span>

                        <div class="actions">
                            <div class="btn-toolbar pull-right-sm" role="toolbar">
                                <div class="btn-group">
                                    <button class="btn btn-default"
                                            data-bind="click: $root.toggleDatabase, 
                                                       css: { 'btn-spinner': inProgressAction }, 
                                                       disable: isBeingDeleted() || inProgressAction()">
                                        <span data-bind="visible: inProgressAction(), text: inProgressAction()"></span>

                                        <i class="icon-unlock" data-bind="visible: !inProgressAction() && disabled()"></i>
                                        <span data-bind="visible: !inProgressAction() && disabled()">Enable</span>

                                        <i class="icon-lock" data-bind="visible: !inProgressAction() && !disabled()"></i>
                                        <span data-bind="visible: !inProgressAction() && !disabled()">Disable</span>
                                    </button>
                                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"  
                                            data-bind="disable: isBeingDeleted() || inProgressAction()">
                                        <span class="caret"></span>
                                        <span class="sr-only">Toggle Dropdown</span>
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li data-bind="visible: online() && !indexingPaused() && !indexingDisabled()">
                                            <a href="#" data-bind="click: $root.togglePauseDatabaseIndexing">
                                                <i class="icon-pause"></i> Pause indexing
                                            </a>
                                        </li>
                                        <li data-bind="visible: indexingPaused()">
                                            <a href="#" data-bind="click: $root.togglePauseDatabaseIndexing">
                                                <i class="icon-play"></i> Resume indexing
                                            </a>
                                        </li>
                                        <li data-bind="visible: !indexingDisabled()">
                                            <a href="#" data-bind="click: $root.toggleDisableDatabaseIndexing">
                                                <i class="icon-lock"></i> Disable indexing
                                            </a>
                                        </li>
                                        <li data-bind="visible: indexingDisabled()">
                                            <a href="#" data-bind="click: $root.toggleDisableDatabaseIndexing">
                                                <i class="icon-play"></i> Enable indexing
                                            </a>
                                        </li>
                                        <li>
                                            <!--<a href="#" class="btn-prerelease" data-bind="click: $root.toggleRejectDatabaseClients.bind($root, $data)"> -->
                                            <a href="#" class="btn-prerelease">
                                                <i class="icon-umbrella"></i> Reject clients mode
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                                <button class="btn btn-danger" data-bind="click: $root.deleteDatabase, disable: isBeingDeleted"> 
                                    <i class="icon-trash"></i>
                                    <span>Delete</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/html" id="invalid-database-properties-template">
    <div class="text-danger">
        <i class="icon-exclamation"></i>
        <span data-bind="text: loadError"></span>
    </div>
</script>

<script type="text/html" id="valid-database-properties-template">
    <div class="properties-item" data-bind="visible: totalSize">
        <div class="properties-value value-only">
            <div class="set-size">
                <i class="icon-drive"></i>
                <span data-bind="text: totalSize"></span>
            </div>
        </div>
    </div>

    <div class="properties-item" data-bind="visible: $data.qualifier === 'db', if: $data.qualifier === 'db'">
        <div class="properties-value value-only">
            <div class="set-size">
                <i class="icon-document-group"></i>
                <span data-bind="text: $root.pluralize(documentsCount().toLocaleString(), 'document', 'documents')"></span>
            </div>
        </div>
    </div>

    <div class="properties-item" data-bind="visible: $data.qualifier === 'db', if: $data.qualifier === 'db'">
        <div class="properties-value value-only">
            <div class="set-size">
                <i class="icon-index"></i>
                <span data-bind="text: $root.pluralize(indexesCount().toLocaleString(), 'index', 'indexes')"></span>
            </div>
        </div>
    </div>

    <div class="properties-item" data-bind="visible: errors()">
        <div class="properties-value value-only text-danger">
            <div class="set-size">
                <i class="icon-exclamation"></i>
                <span data-bind="text: $root.pluralize(errors().toLocaleString(), 'error', 'errors')"></span>
            </div>
        </div>
    </div>

    <div class="properties-item" data-bind="visible: alerts()">
        <div class="properties-value value-only text-warning">
            <div class="set-size">
                <i class="icon-warning"></i>
                <span data-bind="text: $root.pluralize(alerts().toLocaleString(), 'alert', 'alerts')"></span>
            </div>
        </div>
    </div>

    <div class="properties-item" data-bind="visible: backupEnabled()">
        <div data-bind="attr: { class: 'properties-value value-only ' + backupStatus() }">
            <div class="set-size">
                <i class="icon-backup"></i>
                <span data-bind="text: backupStatus() !== 'text-danger' ? 'Backed up ' + lastFullOrIncrementalBackup() : 'Never backed up'"></span>
            </div>
        </div>
    </div>

    <div class="properties-item" data-bind="visible: uptime()">
        <div class="properties-value value-only ">
            <div class="set-size">
                <i class="icon-recent"></i>
                <span data-bind="text: 'Up for ' + uptime()"></span>
            </div>
        </div>
    </div>

    <div class="properties-item" data-bind="visible: indexingPaused() && !indexingDisabled()">
        <div class="properties-value value-only text-warning">
            <div class="set-size">
                <i class="icon-pause"></i>
                <span>Indexing paused</span>
            </div>
        </div>
    </div>

    <div class="properties-item" data-bind="visible: indexingDisabled()">
        <div class="properties-value value-only text-warning">
            <div class="set-size">
                <i class="icon-lock"></i>
                <span>Indexing Disabled</span>
            </div>
        </div>
    </div>

    <div class="properties-item" data-bind="visible: rejectClients()">
        <div class="properties-value value-only text-warning">
            <div class="set-size">
                <i class="icon-umbrella"></i>
                <span>Clients rejection mode</span>
            </div>
        </div>
    </div>
    
</script>